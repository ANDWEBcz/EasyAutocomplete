/*
 * Easy-autocomplete
 * jQuery plugin for autocompletion
 * 
 * @author Łukasz Pawełczak
 * @version 1.0.0
 * Copyright MIT License: https://github.com/pawelczak/easy-autocomplete/blob/master/LICENSE.txt
 */

var EasyAutocomplete=function(a){return a.Configuration=function(a){function b(){"xml"==a.dataType&&(a.getValue||(a.getValue=function(a){return $(a).text()}),a.list||(a.list={}),a.list.sort||(a.list.sort={}),a.list.sort.method=function(b,c){return b=a.getValue(b),c=a.getValue(c),c>b?-1:b>c?1:0},a.list.match||(a.list.match={}),a.list.match.method=function(b,c){return b=a.getValue(b),c=a.getValue(c),b===c?!0:!1})}function c(){function b(a,c){var d=a||{};for(var e in a)void 0!==c[e]&&null!==c[e]&&("object"!=typeof c[e]||c[e]instanceof Array?d[e]=c[e]:b(a[e],c[e]));return d}f=b(f,a)}function d(){if("list-required"!==f.url&&"function"!=typeof f.url){var a=f.url;f.url=function(){return a}}if("string"==typeof f.listLocation){var b=f.listLocation;f.listLocation=function(a){return a[b]}}}function e(a){return void 0!==f[a]&&null!==f[a]?!0:!1}var f={data:"list-required",url:"list-required",dataType:"json",listLocation:function(a){return a},xmlElementName:"",getValue:function(a){return a},autocompleteOff:!0,placeholder:!1,ajaxCallback:function(){},list:{sort:{enabled:!1,method:function(a,b){return a=f.getValue(a),b=f.getValue(b),b>a?-1:a>b?1:0}},maxNumberOfElements:6,match:{enabled:!1,caseSensitive:!1,method:function(a,b){return a=f.getValue(a),b=f.getValue(b),a===b?!0:!1}},showAnimation:{type:"normal",time:400,callback:function(){}},hideAnimation:{type:"normal",time:400,callback:function(){}}},highlightPhrase:!0};b(),c(),d(),this.get=function(a){return f[a]},this.equals=function(a,b){return e(a)&&f[a]===b?!0:!1},this.checkDataUrlProperties=function(){return"list-required"===f.url&&"list-required"===f.data?!1:!0},this.checkRequiredProperties=function(){for(var a in f)if("required"===f[a])return logger.error("Option "+a+" must be defined"),!1;return!0}},a}(EasyAutocomplete||{}),EasyAutocomplete=function(a){return a.Logger=function(){this.error=function(a){console.log("ERROR: "+a)},this.warning=function(a){console.log("WARNING: "+a)}},a}(EasyAutocomplete||{}),EasyAutocomplete=function(a){return a.Constans=function(){var a={CONTAINER_CLASS:"easy-autocomplete-container",CONTAINER_ID:"eac-container-",WRAPPER_CSS_CLASS:"easy-autocomplete"};this.getValue=function(b){return a[b]}},a}(EasyAutocomplete||{}),EasyAutocomplete=function(a){return a.proccess=function(a,b,c){function d(b,c){var d=[],e="";if(a.get("list").match.enabled)for(var f=0,g=b.length;g>f;f+=1)e=a.get("getValue")(b[f]),a.get("list").match.caseSensitive||("string"==typeof e&&(e=e.toLowerCase()),c=c.toLowerCase()),e.search(c)>-1&&d.push(b[f]);else d=b;return d}function e(b){return b.length>a.get("list").maxNumberOfElements&&(b=b.slice(0,a.get("list").maxNumberOfElements)),b}function f(b){return a.get("list").sort.enabled&&b.sort(a.get("list").sort.method),b}var g=c;return b=d(b,g),b=e(b),b=f(b)},a}(EasyAutocomplete||{}),EasyAutocomplete=function(a){return a.main=function(b,c){function d(){return n.checkDataUrlProperties()?n.checkRequiredProperties()?(e(),void g()):void o.error("Will not work without mentioned properties."):void o.error("One of options variables 'data' or 'url' must be defined.")}function e(){function a(){var a=$("<div>"),c=b.outerWidth();a.addClass(m.getValue("WRAPPER_CSS_CLASS")).css("width",c),b.wrap(a)}function c(){b.unwrap()}function d(){var a=$("<div>").addClass(m.getValue("CONTAINER_CLASS"));a.attr("id",f()).prepend($("<ul>")),function(){a.on("show",function(){switch(n.get("list").showAnimation.type){case"slide":var b=n.get("list").showAnimation.time,c=n.get("list").showAnimation.callback;a.find("ul").slideDown(b,c);break;case"fade":var b=n.get("list").showAnimation.time,c=n.get("list").showAnimation.callback;a.find("ul").fadeIn(b),c;break;default:a.find("ul").show()}}).on("hide",function(){switch(n.get("list").hideAnimation.type){case"slide":var b=n.get("list").hideAnimation.time,c=n.get("list").hideAnimation.callback;a.find("ul").slideUp(b,c);break;case"fade":var b=n.get("list").hideAnimation.time,c=n.get("list").hideAnimation.callback;a.find("ul").fadeOut(b,c);break;default:a.find("ul").hide()}}).on("selectElement",function(){a.find("ul li").removeClass("selected"),a.find("ul li:nth-child("+(t+1)+")").addClass("selected")}).on("loadElements",function(c,d,e){var f="",h=($("<ul>"),a.find("ul"));h.empty();for(var i=0,k=d.length;k>i;i+=1)f=$("<li><span></span></li>"),function(){var a=i,c=n.get("getValue")(d[a]);f.find("span").on("click",function(){b.val(c),j(a)}).mouseover(function(){}).html(g(c,e))}(),h.append(f)})}(),b.after(a)}function e(){b.next("."+m.getValue("CONTAINER_CLASS")).remove()}function g(a,b){return n.get("highlightPhrase")&&""!==b?h(a,b):a}function h(a,b){return(a+"").replace(new RegExp("("+b+")","gi"),"<b>$1</b>")}b.parent().hasClass(m.getValue("WRAPPER_CSS_CLASS"))&&(e(),c()),a(),d(),r=$("#"+f()),n.placeholder!==!1&&b.attr("placeholder",n.placeholder)}function f(){var a=b.attr("id");if(void 0===a||null===a){do a=m.getValue("CONTAINER_ID")+Math.rand(1e4);while(0==$("#"+a).length)}else a=m.getValue("CONTAINER_ID")+a;return a}function g(){function a(){q("autocompleteOff",!0)&&m(),c(),d(),e(),f(),g()}function c(){b.off("keyup").keyup(function(a){function c(){function a(a){var b=[];return $(a).find(n.get("xmlElementName")).each(function(){b.push(this)}),b}var c=b.val();"list-required"!==n.get("data")&&(s=p(n,n.get("data"),b.val()),k(s,c),h()),"list-required"!==n.get("url")&&$.ajax({url:n.get("url")(c),dataType:n.get("dataType")}).done(function(d){s=n.get("listLocation")(d);var e=s.length;0!==e&&("XML"===n.get("dataType").toUpperCase()&&(s=a(s)),s=p(n,s,b.val()),k(s,c),h(),n.get("ajaxCallback")())}).fail(function(){o.warning("Fail to load response data")}).always(function(){})}switch(a.keyCode){case 27:i(),l();break;case 38:a.preventDefault(),s.length>0&&t>0&&(t-=1,b.val(n.get("getValue")(s[t])),j(t));break;case 40:s.length>0&&t<s.length-1&&(a.preventDefault(),t+=1,b.val(n.get("getValue")(s[t])),j(t));break;default:c()}})}function d(){b.keydown(function(a){return 38===a.keyCode?!1:void(13===a.keyCode&&(a.preventDefault(),i()))})}function e(){b.off("keypress").keypress(function(){})}function f(){b.focus(function(){""!==b.val()&&s.length>0&&(t=-1,h())})}function g(){b.blur(function(){setTimeout(function(){t=-1,i()},250)})}function m(){b.attr("autocomplete","off")}a()}function h(){r.trigger("show"),j(t)}function i(){r.trigger("hide")}function j(a){r.trigger("selectElement",a)}function k(a,b){r.trigger("loadElements",[a,b])}function l(){b.trigger("blur")}var m=new a.Constans,n=new a.Configuration(c),o=new a.Logger,p=a.proccess,q=n.equals,b=b,r="",s=[],t=-1;this.getConfiguration=function(){return n},this.getConstants=function(){return m},this.getContainer=function(){return r},this.build=function(){e()},this.init=function(){d()}},a}(EasyAutocomplete||{});$.fn.easyAutocomplete=function(a){new EasyAutocomplete.main(this,a).init()};